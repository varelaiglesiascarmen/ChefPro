# ============================================
# railway.toml - Railway Configuration
# ============================================
# This file tells Railway HOW to build and deploy the app.
# Railway detects it automatically at the service root.
#
# Documentation: https://docs.railway.com/reference/config-as-code
# ============================================

[build]
# Tell Railway to use the Dockerfile we created
dockerfilePath = "src/backend/Dockerfile"
# Build context is the repo root (railway up uploads from here)
dockerContext = "."

[deploy]
# Use sh -c so $PORT gets expanded by the shell
startCommand = "sh -c 'java -Dserver.port=${PORT:-8080} -jar /app/app.jar'"
# Railway injects $PORT; Spring Boot reads it via ${PORT:8081}
# Healthcheck: Railway verifies the app responds before routing traffic
healthcheckPath = "/api/auth/health"
healthcheckTimeout = 300
# Auto-restart if the app crashes
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3
