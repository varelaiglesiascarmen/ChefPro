<div class="search-page-container">

  <div class="results-header">
    <div class="header-text">

      <h1>
        <span *ngIf="searchTerm">Resultados para "<em>{{ searchTerm }}</em>"</span>
        <span *ngIf="!searchTerm">Explora nuestros Chefs y Menús</span>
      </h1>

      <p class="subtitle">
        <span *ngIf="isLoading">Buscando...</span>
        <span *ngIf="!isLoading && !noResults">
          {{ totalResults }} {{ totalResults === 1 ? 'resultado encontrado' : 'resultados encontrados' }}
        </span>
        <span *ngIf="!isLoading && noResults">
          No encontramos resultados para "<em>{{ searchTerm }}</em>", pero quizás te interese...
        </span>
      </p>

    </div>
  </div>

  <div class="results-grid-container">

    <div *ngIf="isLoading" class="loading-state">
      <div class="spinner-modern"></div>
      <p>Encendiendo fogones...</p>
    </div>

    <ng-container *ngIf="!isLoading">

      <!-- ===== SECTION 1: CITIES WITH THEIR CHEFS ===== -->
      <ng-container *ngFor="let city of cities">
        <section *ngIf="getChefsForCity(city).length > 0" class="section-city">
          <h2 class="section-title">
            <span class="city-icon">&#x1F4CD;</span> Chefs en {{ city }}
          </h2>
          <div class="chefs-grid">
            <div *ngFor="let chef of getChefsForCity(city)" class="chef-card" (click)="goToChefDetail(chef.id)">
              <div class="card-image-wrapper">
                <img [src]="chef.photo || '/logos/users.svg'" alt="{{ chef.name }}" class="chef-img"
                  (error)="chef.photo = '/logos/users.svg'">
                <div class="rating-badge">★ {{ chef.avgScore ?? '—' }}</div>
              </div>
              <div class="card-body">
                <div class="chef-header">
                  <h3>{{ chef.name }} {{ chef.lastname }}</h3>
                </div>
                <div class="divider"></div>
                <div class="card-footer">
                  <div class="price-block">
                    <span class="label">Desde: </span>
                    <span class="amount">{{ chef.startingPrice ?? '—' }} €</span>
                  </div>
                  <button class="btn-solicitar" (click)="$event.stopPropagation(); onReserveChef(chef)">
                    Solicitar
                  </button>
                </div>
              </div>
            </div>
          </div>
        </section>
      </ng-container>

      <!-- ===== SECTION 2: CHEFS (excluding those already shown in a city) ===== -->
      <section *ngIf="remainingChefs.length > 0" class="section-chefs">
        <h2 class="section-title">Chefs</h2>
        <div class="chefs-grid">

          <div *ngFor="let chef of remainingChefs" class="chef-card" (click)="goToChefDetail(chef.id)">

            <div class="card-image-wrapper">
              <img [src]="chef.photo || '/logos/users.svg'" alt="{{ chef.name }}" class="chef-img"
                (error)="chef.photo = '/logos/users.svg'">
              <div class="rating-badge">★ {{ chef.avgScore ?? '—' }}</div>
            </div>

            <div class="card-body">
              <div class="chef-header">
                <h3>{{ chef.name }} {{ chef.lastname }}</h3>
                <span *ngIf="chef.location" class="location-pill">&#x1F4CD; {{ chef.location }}</span>
              </div>

              <div class="divider"></div>

              <div class="card-footer">
                <div class="price-block">
                  <span class="label">Desde: </span>
                  <span class="amount">{{ chef.startingPrice ?? '—' }} €</span>
                </div>
                <button class="btn-solicitar" (click)="$event.stopPropagation(); onReserveChef(chef)">
                  Solicitar
                </button>
              </div>
            </div>

          </div>
        </div>
      </section>

      <!-- ===== SECTION 3: FOOD TYPES / MENUS (real results or random suggestions) ===== -->
      <section *ngIf="remainingMenus.length > 0" class="section-menus">
        <h2 class="section-title">{{ noResults ? 'Quizás te interese' : 'Tipos de Comida' }}</h2>
        <div class="chefs-grid">

          <div *ngFor="let menu of remainingMenus" class="chef-card" (click)="goToMenuDetail(menu.menuId)">

            <div class="card-image-wrapper">
              <img [src]="menu.chefPhoto || '/logos/users.svg'" alt="{{ menu.menuTitle }}" class="chef-img"
                (error)="menu.chefPhoto = '/logos/users.svg'">
              <div class="rating-badge">★ {{ menu.avgScore ?? '—' }}</div>
            </div>

            <div class="card-body">
              <div class="chef-header">
                <h3>{{ menu.menuTitle }}</h3>
                <span *ngIf="menu.chefLocation" class="location-pill">&#x1F4CD; {{ menu.chefLocation }}</span>
              </div>

              <p class="menu-chef-name">por {{ menu.chefName }} {{ menu.chefLastname }}</p>

              <div class="divider"></div>

              <div class="card-footer">
                <div class="price-block">
                  <span class="label">Precio por persona: </span>
                  <span class="amount">{{ menu.pricePerPerson }} €</span>
                </div>
                <button class="btn-solicitar" (click)="$event.stopPropagation(); onReserveMenu(menu)">
                  Solicitar
                </button>
              </div>
            </div>

          </div>
        </div>
      </section>

      <!-- ===== NO RESULTS AT ALL ===== -->
      <div *ngIf="cities.length === 0 && chefs.length === 0 && menus.length === 0" class="empty-state">
        <p>No se encontraron resultados.</p>
      </div>

    </ng-container>

  </div>
</div>

<!-- Modal login -->
<div *ngIf="showLoginModal" class="modal-overlay" (click)="closeLoginModal()">
  <div class="modal-card" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>¡Hola!</h3>
      <button class="close-btn" (click)="closeLoginModal()">✕</button>
    </div>
    <div class="modal-body">
      <p>Para reservar a tu chef privado, necesitamos saber quién eres. Inicia sesión para continuar y asegurar tu
        experiencia gastronómica única.</p>
    </div>
    <div class="modal-footer">
      <button class="btn-cancel" (click)="closeLoginModal()">Cancelar</button>
      <button class="btn-confirm" (click)="goToLogin()">Login</button>
    </div>
    <p>Si no tienes cuenta, <a href="/signup">regístrate aquí</a></p>
  </div>
</div>