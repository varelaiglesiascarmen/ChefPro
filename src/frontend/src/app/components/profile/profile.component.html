<div class="profile-wrapper fadeIn">

  <div *ngIf="role === 'CHEF'" class="chef-dashboard">

    <aside class="sidebar">
      <div class="chef-info-min">
        <div class="avatar-frame">
          <img [src]="chefProfile.photo || 'assets/default-chef.png'" class="avatar">
        </div>
        <h3>Chef {{ user.name }}</h3>
        <p class="professional-tag">Professional Chef</p>
      </div>

      <nav class="side-nav">
        <button [class.active]="activeTab === 'info'" (click)="activeTab = 'info'">Mi Perfil</button>
        <button [class.active]="activeTab === 'menus'" (click)="activeTab = 'menus'">Mis Menús</button>
        <button [class.active]="activeTab === 'orders'" (click)="activeTab = 'orders'">
          Pedidos
          <span class="counter" *ngIf="pendingOrders.length > 0">{{ pendingOrders.length }}</span>
        </button>
        <button [class.active]="activeTab === 'calendar'" (click)="activeTab = 'calendar'">Calendario</button>
      </nav>

      <button class="btn-logout" (click)="logout()">Cerrar Sesión</button>
    </aside>

    <main class="content-area">

      <section *ngIf="activeTab === 'info'" class="tab-content fadeIn">
        <div class="card gourmet-card">
          <div class="header-row">
            <h2>Información Profesional</h2>
            <div class="actions">
              <button class="btn-gold" (click)="editMode = !editMode" *ngIf="!editMode">Editar Perfil</button>
              <button class="btn-save-gourmet" (click)="updateProfile()" *ngIf="editMode">Guardar Cambios</button>
              <button class="btn-cancel" (click)="editMode = false" *ngIf="editMode">Cancelar</button>
            </div>
          </div>

          <div class="profile-form-grid">
            <div class="form-group" *ngIf="editMode">
              <label class="label-subtitle">URL de la Foto</label>
              <input [(ngModel)]="chefProfile.photo" placeholder="https://...">
            </div>

            <div class="form-group">
              <label class="label-subtitle">Biografía Profesional</label>
              <textarea [(ngModel)]="chefProfile.bio" [disabled]="!editMode" placeholder="Tu trayectoria culinaria..."></textarea>
            </div>

            <div class="form-group">
              <label class="label-subtitle">Premios y Reconocimientos</label>
              <input [(ngModel)]="chefProfile.prizes" [disabled]="!editMode" placeholder="Ej: Estrella Michelin, Sol Repsol...">
            </div>

            <div class="info-readonly-box">
              <div class="info-item">
                <span class="mini-label">Email de contacto</span>
                <p>{{ user.email }}</p>
              </div>
              <div class="info-item">
                <span class="mini-label">Teléfono</span>
                <p>{{ user.phone_number || 'Sin asignar' }}</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section *ngIf="activeTab === 'menus'" class="tab-content fadeIn">
        <div class="card gourmet-card">
          <div class="header-row">
            <h2>Gestión de Menús</h2>
            <button class="btn-gold" (click)="router.navigate(['/new-menu'])">+ Nuevo Menú</button>
          </div>
          <div class="menu-grid">
            <div *ngFor="let menu of myMenus" class="mini-menu-card card">
              <div class="menu-header">
                <h4>{{ menu.title }}</h4>
                <span class="price-tag">{{ menu.price_per_person }}€/pers</span>
              </div>
              <div class="menu-actions">
                <button class="btn-small">Editar</button>
                <button class="btn-small btn-danger" (click)="deleteMenu(menu.menu_ID)">Eliminar</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section *ngIf="activeTab === 'orders'" class="tab-content fadeIn">
        <div class="card gourmet-card">
          <h2>Buzón de Solicitudes</h2>
          <div class="orders-list">
            <div *ngFor="let order of pendingOrders" class="order-item card">
              <div class="order-info">
                <div class="date-badge">{{ order.date | date:'dd MMM yyyy' }}</div>
                <p><strong>Comensal:</strong> {{ order.diner_ID }} ({{ order.n_diners }} pers.)</p>
                <p><strong>Ubicación:</strong> {{ order.address }}</p>
              </div>
              <div class="order-btns">
                <button class="btn-accept" (click)="updateStatus(order, 'CONFIRMED')">Aceptar</button>
                <button class="btn-reject" (click)="updateStatus(order, 'REJECTED')">Rechazar</button>
              </div>
            </div>
            <div class="empty-state" *ngIf="pendingOrders.length === 0">
              <p>No tienes solicitudes pendientes.</p>
            </div>
          </div>
        </div>
      </section>

      <section *ngIf="activeTab === 'calendar'" class="tab-content fadeIn">
        <div class="card gourmet-card">
          <div class="header-row">
            <h2>Agenda de Reservas</h2>
          </div>
          <div class="calendar-display">
            <calendar [busyDates]="getBusyDates()" (dateSelected)="onDateSelected($event)"></calendar>
          </div>
          <div class="calendar-legend-gourmet">
            <div class="legend-item"><span class="dot gold"></span> Confirmado</div>
            <div class="legend-item"><span class="dot brown"></span> Pendiente</div>
          </div>
        </div>
      </section>

    </main>
  </div>

  <div *ngIf="role === 'DINER'" class="diner-view fadeIn">
    <div class="diner-header">
      <h1>Panel de Comensal</h1>
      <p>Bienvenido de nuevo, {{ user.name }}</p>
    </div>
    <div class="card gourmet-card">
      <p>Aquí verás tus próximas experiencias.</p>
      <button class="btn-logout" (click)="logout()">Cerrar Sesión</button>
    </div>
  </div>

</div>
